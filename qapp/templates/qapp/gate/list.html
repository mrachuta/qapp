{% extends 'qapp/base.html' %}
{% load user_tags %}

{% block title %}QAPP - lista bramek{% endblock%}

{% block content %}
<div class="card" id="gate_{{ gate_type }}_list">
    {% if user.is_authenticated %}
    <form action="{% url 'qapp:mass_update' %}" method="post">
        {% csrf_token %}
        <div class="fastaction">
            <button name="new_rating" type="submit" value="OK" id="ok">Akceptuj</button>
            <button name="new_rating" type="submit" value="NOK" id="nok">Odrzuć</button>
        </div>
    {% endif %}
        <table class="wp-table">
            <tr>
                {% if 'bjw' in gate_type %}
                <th>Wózek</th>
                <th>Typ wózka</th>
                {% else %}
                <th>Tramwaj</th>
                <th>Człon</th>
                {% endif %}
                <th>Obszar</th>
                <th>Numer operacji</th>
                <th>Nazwa</th>
                <th>Status bramki</th>
                <th>Ocena</th>
                <th class="center">Zaznacz</th>
            </tr>
            {% for gate in gate_list %}
            <tr class="clickable" id="gate_{{ gate.id }}">
                {% if 'bjw' in gate_type %}
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.bogie }}</a></td>
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.bogie.btype }}</a></td>
                {% else %}
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.tram }}</a></td>
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.car }}</a></td>
                {% endif %}
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.area }}</a></td>
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.operation_no }}</a></td>
                <td class="gate-name"><a href="{{ gate.get_absolute_url }}">{{ gate.name }}</a></td>
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.get_status_display }}</a></td>
                <td><a href="{{ gate.get_absolute_url }}">{{ gate.rating|default:"---" }}</a></td>
                <td class="center">
                    <label for="{{ gate.id }}">
                        <div>
                            <input type="checkbox" id="{{ gate.id }}" name="{{ gate.id }}">
                        </div>
                    </label>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% if user.is_authenticated %}
    </form>
    {% endif %}
    {% if is_paginated %}
    <div class="pagination" align="center">
        <br>
        <span class="page-links">
            {% if page_obj.has_previous %}
            <a href="/qapp/{{ gate_type }}?{% param_replace page=page_obj.previous_page_number %}">poprzednia</a>
            {% else %}
            <a><font color="#CCC9C9">poprzednia</font></a>
            {% endif %}
            <span class="page-current">|  Strona {{ page_obj.number }} z {{ page_obj.paginator.num_pages }}  |</span>
            {% if page_obj.has_next %}
            <a href="/qapp/{{ gate_type }}?{% param_replace page=page_obj.next_page_number %}">następna</a>
            {% else %}
            <a><font color="#CCC9C9">nastepna</font></a>
            {% endif %}
        </span>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block firstcard %}
<h3>Filtrowanie</h3>
<hr>
{% if user.is_authenticated %}
<form method="get">
    <table>
        <tr>
        {% for field in gate_list_filter.form %}
        {% if 'bjw' in gate_type %}
        {% if 'tram' not in field.name and 'car' not in field.name %}
            <td>{{ field.label_tag}}</td>
            <td>{{ field }}</td>
        {% endif %}
        {% else %}
        {% if 'bogie' not in field.name %}
            <td>{{ field.label_tag}}</td>
            <td>{{ field }}</td>
        {% endif %}
        {% endif %}
        </tr>
        {% endfor %}
    </table>
    <hr>
    <button type="submit">Filtruj</button>
    <button onclick="location.href='{{ request.path }}'" type="button">Resetuj</button>
</form>
{% else %}
Filtrowanie dostępne tylko dla zalogowanych użytkowników!
{% endif %}
{% endblock %}